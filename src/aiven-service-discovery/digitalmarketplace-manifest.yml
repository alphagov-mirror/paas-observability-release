---
applications:
  - name: digitalmarketplace-es-metrics
    buildpacks:
      - go_buildpack

    disk_quota: 4G
    memory: 4G

    env:
      AIVEN_API_TOKEN: ((aiven_api_token))
      AIVEN_BASIC_AUTH_USER: ((aiven_username))
      AIVEN_BASIC_AUTH_PASSWORD: ((aiven_password))
      AIVEN_PROJECT: paas-cf-prod
      AIVEN_PROMETHEUS_ENDPOINT_ID: paas-cf-prod
      SERVICE_DISCOVERY_TARGET_PATH: /home/vcap/app/service_prometheus_targets.json
      SERVICES_FILE: /home/vcap/app/digitalmarketplace_aiven_services.json
      PROMETHEUS_LISTEN_PORT: 9096

    processes:
      - type: web
        health-check-type: http
        health-check-http-endpoint: /-/ready
        command: ./run-prometheus.sh

    sidecars:
      - name: aiven_service_discovery
        process_types: ['web']
        command: ./run-aiven-service-discovery.sh
